# default server (blocking calls to IP, different domains) on HTTP:80
server {
  server_name _;
  listen 80 default_server;
  location / {
    return 444;
  }
}

# SSL server
server {
  root /var/www/html;
  index index.php;

  server_name forscope.pl www.forscope.pl; # CHANGE HERE
  listen 443 ssl http2;
  
  client_max_body_size 20M;

  # to www redirect
  if ($host = forscope.pl){.  # CHANGE HERE
     return 301 https://www.$host$request_uri;
  }

  #change Krizan - redirecty index.php
  if ($request_uri ~* "^(.*/)index\.php/(.*)$") {
      return 301 /$2;
  }

  if ($request_uri ~* "^(.*/)index\.php$") {
      return 301 /;
  }

  # blocking app
  location ^~ /app/ {
    deny all;
    return 403;
  }

  # PHP processing
  location ~ \.php$ {
    include fastcgi_params;
    include snippets/fastcgi-php.conf;
    fastcgi_pass unix:/run/php/php7.2-fpm.sock;
  }

  location ~ \.(js|css|png|jpg|jpeg|gif|svg|ico)$ {
    expires 30d;
    add_header Cache-Control "public, no-transform";
    try_files $uri $uri/ /index.php?$query_string;
  }

  location / {
    try_files $uri $uri/ /index.php?$query_string;
  }

  # rest is managed by Certbot...
}
# HTTP server (redirects)
server {
  server_name forscope.pl www.forscope.pl; # CHANGE HERE
  listen 80;
  
  if ($host = www.forscope.pl) { # CHANGE HERE
    return 301 https://$host$request_uri;
  }

  if ($host = forscope.pl) { # CHANGE HERE
    return 301 https://www.$host$request_uri;
  }
  
  return 404; 
}

